{% extends 'base.html' %}

{% block title %}Dashboard Ventas - Kosmos ERP{% endblock %}
{% block page_title %}Estadísticas de Ventas{% endblock %}

{% block content %}
<div class="dashboard-controls" style="margin-bottom: 20px; display: flex; justify-content: flex-end;">
    <form method="get" class="date-filter-form">
        <div class="btn-group">
            <button type="submit" name="range" value="today"
                class="btn {% if date_range == 'today' %}btn-primary{% else %}btn-outline{% endif %}">Hoy</button>
            <button type="submit" name="range" value="week"
                class="btn {% if date_range == 'week' %}btn-primary{% else %}btn-outline{% endif %}">Semana</button>
            <button type="submit" name="range" value="month"
                class="btn {% if date_range == 'month' or not date_range %}btn-primary{% else %}btn-outline{% endif %}">Mes</button>
        </div>
    </form>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <span class="stat-label">Cotizaciones Totales</span>
        <span class="stat-value">{{ total_quotations }}</span>
    </div>
    <div class="stat-card">
        <span class="stat-label">Cotizaciones Aprobadas</span>
        <span class="stat-value">{{ approved_quotations }}</span>
    </div>
    <div class="stat-card">
        <span class="stat-label">Órdenes de Venta</span>
        <span class="stat-value">{{ orders_count }}</span>
    </div>
    <div class="stat-card">
        <span class="stat-label">Monto de Ventas</span>
        <span class="stat-value">${{ total_sales|floatformat:2 }}</span>
    </div>
</div>

<div class="card chart-card" style="margin-bottom: 30px;">
    <h3>Tendencia de Ventas</h3>
    <div style="height: 300px;">
        <canvas id="salesTrendChart"></canvas>
    </div>
</div>

<div style="text-align: right; margin-top: 20px;">
    <a href="{% url 'quotation_list' %}" class="btn btn-primary">Ver Cotizaciones</a>
</div>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('salesTrendChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ chart_labels| safe }},
        datasets: [{
            label: 'Ventas ($)',
            data: {{ chart_data| safe }},
        borderColor: '#3498db',
        backgroundColor: 'rgba(52, 152, 219, 0.1)',
        fill: true,
        tension: 0.4
            }]
        },
        options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            },
            title: {
                display: true,
                text: 'Ventas Diarias'
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    callback: function (value, index, values) {
                        return '$' + value;
                    }
                }
            }
        }
    }
    });
});
</script>
{% endblock %}
{% endblock %}