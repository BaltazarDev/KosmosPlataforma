{% extends 'base.html' %}

{% block title %}Dashboard - Kosmos ERP{% endblock %}
{% block page_title %}Dashboard General{% endblock %}

{% block content %}
<div class="dashboard-controls" style="margin-bottom: 20px; display: flex; justify-content: flex-end;">
    <form method="get" class="date-filter-form">
        <div class="btn-group">
            <button type="submit" name="range" value="today"
                class="btn {% if date_range == 'today' %}btn-primary{% else %}btn-outline{% endif %}">Hoy</button>
            <button type="submit" name="range" value="week"
                class="btn {% if date_range == 'week' %}btn-primary{% else %}btn-outline{% endif %}">Semana</button>
            <button type="submit" name="range" value="month"
                class="btn {% if date_range == 'month' or not date_range %}btn-primary{% else %}btn-outline{% endif %}">Mes</button>
        </div>
    </form>
</div>

<div class="stats-grid">
    <div class="stat-card">
        <span class="stat-label">Clientes Totales</span>
        <span class="stat-value">{{ total_clients }}</span>
        <span class="stat-trend"><i class="fas fa-users"></i></span>
    </div>
    <div class="stat-card">
        <span class="stat-label">Proveedores</span>
        <span class="stat-value">{{ total_providers }}</span>
        <span class="stat-trend"><i class="fas fa-truck"></i></span>
    </div>
    <div class="stat-card">
        <span class="stat-label">Ventas (Periodo)</span>
        <span class="stat-value">${{ period_sales|floatformat:2 }}</span>
        <span class="stat-trend success"><i class="fas fa-arrow-up"></i></span>
    </div>
    <div class="stat-card">
        <span class="stat-label">Compras (Periodo)</span>
        <span class="stat-value">${{ period_purchases|floatformat:2 }}</span>
        <span class="stat-trend warning"><i class="fas fa-shopping-bag"></i></span>
    </div>
</div>

<div class="charts-container" style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-top: 20px;">
    <div class="card chart-card">
        <h3>Resumen Financiero</h3>
        <canvas id="financialChart"></canvas>
    </div>
    <div class="card chart-card">
        <h3>Distribuci√≥n de Actividad</h3>
        <canvas id="activityChart"></canvas>
    </div>
</div>

<style>
    .btn-group {
        display: flex;
        gap: 5px;
    }

    .btn {
        padding: 8px 16px;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        background: white;
    }

    .btn-primary {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }

    .btn-outline {
        background: transparent;
    }

    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        display: flex;
        flex-direction: column;
        position: relative;
    }

    .stat-trend {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 1.2em;
        color: #95a5a6;
    }

    .stat-trend.success {
        color: #2ecc71;
    }

    .stat-trend.warning {
        color: #f1c40f;
    }

    .charts-container .card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Financial Chart
        const ctx = document.getElementById('financialChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels: {{ chart_labels| safe }},
        datasets: [{
            label: 'Ventas',
            data: {{ chart_sales| safe }},
        borderColor: '#2ecc71',
        backgroundColor: 'rgba(46, 204, 113, 0.1)',
        fill: true,
        tension: 0.4
            }, {
            label: 'Compras',
            data: {{ chart_purchases| safe }},
        borderColor: '#e74c3c',
        backgroundColor: 'rgba(231, 76, 60, 0.1)',
        fill: true,
        tension: 0.4
            }]
        },
        options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'top',
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
    });

    // Activity Distribution (Example - simpler for now using static ratios or counts if passed)
    // We didn't calculate distribution in view, so I'll use simple counts passed
    const ctx2 = document.getElementById('activityChart').getContext('2d');
    new Chart(ctx2, {
        type: 'doughnut',
        data: {
            labels: ['Ventas Activas', 'Compras', 'Clientes', 'Proveedores'],
            datasets: [{
                data: [
                    {{ active_orders }},
            {{ total_providers }}, // Just using available stats for demo
                    {{ total_clients }},
        {{ total_providers }}
                ],
        backgroundColor: [
        '#3498db',
        '#9b59b6',
        '#f1c40f',
        '#e67e22'
    ]
            }]
        },
        options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'bottom'
            }
        }
    }
    });
});
</script>
{% endblock %}